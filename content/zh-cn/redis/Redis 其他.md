---
title: "redis必知必会"
date: 2020-05-02T20:20:42+08:00
draft: false
type: posts
categories: ["Redis"]
tags: ['redis']
---

##### Redis 其他

###### redis 数据淘汰机制

当机器内存不够的时候（达到物理机器或者配置的内存上限时），redis会依据数据淘汰机制淘汰一部分数据，有以下6种方式：

* _volatile-lru_： 在设置了过期时间的key中，使用LRU（最近最少使用）算法，将最近最少使用的key淘汰
* _volatile-ttl_： 在设置了过期时间的key中，根据TTL（time to live）时间，将快要过期的数据淘汰
* _volatile-random_： 在设置了过期时间的key中，随机淘汰数据
* _allkeys-lru_： 在所有key中，淘汰最近最少使用的数据
* _allkeys-random_： 在所有key中，随机淘汰数据
* _noeviction_： 禁止淘汰数据

###### redis缓存穿透、击穿、雪崩

* 缓存穿透：请求数据在redis中查询，查询不到，最后请求落到了数据库
* 缓存击穿：热门数据突然失效，大量请求到了数据库
* 缓存雪崩：大量数据同时失效

`Note: 解决方案：`

* 穿透：对于非法参数（eg：id<=0）增加参数校验，过滤掉不存在数据的请求；对于合法参数(eg: id=xxxx)，但是数据不存在：将数据设置为null
* 击穿：设置热点数据永不过期
* 雪崩：避免大量数据同一时间过期：分散过期时间；分散数据到不同缓存数据库

###### master-slave

1. 作用：主从备份，防止节点宕机；读写分离，达到负载均衡目的，提高系统吞吐量
2. 全量同步，发生在slave初始化阶段：
   1. slave连接master，发送SYNC命令
   2. master收到命令后，开始执行BGSAVE命令生成rdb文件，并使用缓冲区记录此后所执行的_写命令_
   3. master执行完BGSAVE命令后，向所有slave发送rdb文件
   4. slave收到rdb文件后，丢弃所有旧数据，载入收到的数据
   5. master发送完文件后，就开始放送缓冲区中的写命令
   6. slave完成数据载入后，开始接收命令请求，并执行来自master同步的写命令
3. 增量同步：slave初始化后正常工作，接收master发送的写命令。master每执行一个写命令就会向slave发送相同的写命令，slave接收并执行收到的写命令
4. 同步策略：master、slave刚刚连接的时候，进行全量同步；全量同步结束后开始增量同步。如果有需要的话，slave在任何时候都可以发起全量同步。redis策略为，首先先进行增量同步，如不成功，进行全量同步

